# Claude Code Implementation Brief - Collaborative Alignment Tool

## Project Overview
We need to implement a collaborative alignment research tool that studies how users and AI systems work together to refine personal identity representations. This is a modification of an existing cover letter generation tool to focus on the collaborative alignment research questions.

## Current Codebase Context
- **Repository**: https://github.com/cowelltechlab/co-well-lab-LLM
- **Frontend**: Vite + React (port 5173)
- **Backend**: Flask API (port 5002)
- **Database**: MongoDB
- **LLM Integration**: Azure OpenAI + Platform OpenAI (existing)
- **Production**: Docker compose with Nginx + Caddy

## Implementation Goal
Transform the existing cover letter generation flow into a sequential bullet refinement process for research on collaborative alignment and identity representation.

## Required User Flow Implementation

### 1. Upload Screen
- **Keep existing**: Resume and job description text input areas
- **Update copy**: 
```
**Welcome to LL.me: Collaborative Alignment Tool**

Thank you for participating in this study! This tool is designed to explore how you and AI can work together to create a personal profile statement that truly reflects your identity, values, and priorities.

To start, you'll paste in your resume and a job description.

Then, you'll read a short profile statement generated by the tool, rate how well it reflects you, and provide feedback on it.

After that, you'll collaborate with the tool to refine and create a new profile statement that better aligns with your goals and self-understanding.
```
- **Maintain**: Pre-filled sample data for testing

### 2. Control Profile Screen 
- **Generate**: Initial professional profile using existing LLM integration
- **Add**: 4 Likert scales (1-7) for research measurement:
  - "The personal profile statement accurately represents me."
  - "I felt in control of how I was represented by the AI tool."
  - "The process allowed me to express my identity in my own words."
  - "I was satisfied with the alignment between my intended identity and the AI output."
- **Add**: 3 open-ended feedback questions:
  - What do you like about this description?
  - What don't you like or feels inaccurate?
  - How would you change it?

### 3. Sequential Bullet Refinement (Core New Feature)
**Key Change**: Instead of rating all bullets at once, implement one-bullet-at-a-time workflow:

- **Generate 3 BSE-theory bullets** from resume + job description
- **Present bullets sequentially**: "Bullet 1 of 3 - Iteration 1"
- **For each bullet**:
  - Display bullet text + rationale
  - Collect 1-7 Likert rating: "To what extent does this sound like you?"
  - Collect open feedback: "What would you change?"
  - **Two buttons**:
    - "Regenerate with Feedback" → Use feedback to create new iteration
    - "All Done" → Move to next bullet (or final profile if last bullet)
- **Allow unlimited iterations** per bullet until user satisfied
- **Track all data**: Store every iteration with ratings + feedback

### 4. Final Aligned Profile Screen
- **Generate**: Final profile using all bullet feedback + iteration data
- **Use identical structure** as control profile:
  - Same 4 Likert scales
  - Same 3 open-ended questions
- **Purpose**: Enable clean pre/post comparison for research

### 5. Comparison Interface
- **Side-by-side display**: Control profile vs Aligned profile
- **For research interviews**: Clean comparison view

## Technical Implementation Requirements

### New API Endpoints Needed
```
POST /api/generate-bse-bullets
- Input: resume, jobDescription
- Output: 3 bullets with rationales

POST /api/regenerate-bullet  
- Input: bulletText, userRating, userFeedback, iterationHistory
- Output: revised bullet with rationale

POST /api/generate-aligned-profile
- Input: all bullet iterations + feedback data
- Output: final aligned profile

POST /api/save-iteration-data
- Input: bulletIndex, iterationNumber, rating, feedback, bulletText
- Output: success confirmation
```

### Data Schema Updates
```javascript
// Add to existing user session schema:
{
  controlProfile: {
    text: String,
    likertResponses: {
      accuracy: Number,
      control: Number, 
      expression: Number,
      alignment: Number
    },
    openResponses: {
      likes: String,
      dislikes: String,
      changes: String
    }
  },
  
  bulletIterations: [
    {
      bulletIndex: Number,
      iterations: [
        {
          iterationNumber: Number,
          bulletText: String,
          rationale: String,
          userRating: Number,
          userFeedback: String,
          timestamp: Date
        }
      ],
      finalIteration: Number
    }
  ],
  
  alignedProfile: {
    text: String,
    likertResponses: { /* same structure as control */ },
    openResponses: { /* same structure as control */ }
  }
}
```

### Frontend Component Updates
- **Modify existing upload flow** to use new copy
- **Create BulletRefinement component** for sequential iteration
- **Create LikertScale component** (fix spacing issues with Tailwind/Radix)
- **Update ProfileDisplay component** to handle both control and aligned versions
- **Add ComparisonView component** for side-by-side display
- **Implement progress tracking** showing current bullet and iteration

### Prompt Engineering Requirements
The researchers need an **admin interface** to easily modify prompts without code changes.

**Add to existing admin dashboard** (letterlab.me/admin):
- **New section**: "Prompt Management" 
- **Display current prompts** with labels and edit functionality
- **Version control**: Track prompt changes with timestamps
- **Reset to default**: Option to revert prompt changes

**Required prompt types to manage**:

**Control Profile Prompt**:
```
Based on the resume and job description, generate a professional profile statement (1-2 paragraphs) that highlights relevant experience and skills...
```

**BSE Bullet Generation Prompt**:
```
Generate 3 bullet points from this resume that demonstrate self-efficacy experiences relevant to this job. Focus on Bandura's Self-Efficacy theory: mastery experiences, vicarious experiences, or verbal persuasion. Include rationale for each bullet explaining the BSE connection...
```

**Bullet Regeneration Prompt**:
```
The user rated this bullet {rating}/7 and provided feedback: '{feedback}'. Revise the bullet to better represent their self-concept while maintaining BSE theory focus. Previous iterations: {iterationHistory}...
```

**Final Profile Synthesis Prompt**:
```
Create a final professional profile using these refined bullets and user feedback. Synthesize the collaborative alignment process into an authentic representation: {bulletData}...
```

## Implementation Priority
1. **Core sequential workflow** - Most critical for research validity
2. **Data collection structure** - Essential for research questions  
3. **Prompt management interface** - Needed for researcher control
4. **UI polish** - Important but secondary to functionality

## Key Differences from Prototype
- **Real LLM integration** instead of static responses
- **Proper data persistence** with MongoDB
- **Admin prompt management** for researchers
- **Production-ready error handling** and validation
- **Responsive design** improvements with Tailwind
- **Proper Likert scale spacing** (current HTML prototype has CSS issues)

## Success Criteria
- Users can iterate on individual bullets until satisfied
- All interaction data is captured for research analysis
- Researchers can modify prompts without code changes
- Clean pre/post comparison data for control vs aligned profiles
- Stable, responsive interface for user studies

## Reference Materials
- **HTML Prototype**: [Provided separately] - Shows complete user flow and interaction patterns
- **Existing Codebase**: GitHub repository with current Flask/React structure
- **Research Questions**: Focus on collaborative alignment, user agency, and identity representation

This implementation will enable the research team to study how users and AI systems collaboratively refine personal identity representations through iterative feedback loops.